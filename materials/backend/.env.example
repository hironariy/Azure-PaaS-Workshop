# =============================================================================
# Backend Environment Configuration - LOCAL DEVELOPMENT
# =============================================================================
# This file is for LOCAL DEVELOPMENT with real Microsoft Entra ID authentication.
# 
# PRODUCTION: Environment variables are configured in Azure App Service:
# - Via Bicep deployment (App Settings)
# - Via Key Vault references for secrets
# See: /design/BackendApplicationDesign.md
#
# Copy this file to .env for local development
# NEVER commit .env to version control
# =============================================================================

# =============================================================================
# Application Settings
# =============================================================================
NODE_ENV=development

# PaaS Change: Default port is 8080 for App Service (IaaS uses 3000)
PORT=8080

# =============================================================================
# Database Connection - LOCAL DEVELOPMENT
# =============================================================================
# Local Docker MongoDB
# Start with: docker-compose -f dev-environment/docker-compose.yml up -d
# Note: Cosmos DB Emulator (MongoDB API) doesn't support Apple Silicon/ARM64
# Mongoose works identically with MongoDB and Cosmos DB for MongoDB vCore
MONGODB_URI=mongodb://localhost:27017/blogapp

# Option 2: Cosmos DB for MongoDB vCore (for testing against Azure)
# Get connection string from Azure Portal > Cosmos DB > Connection strings
# MONGODB_URI=mongodb+srv://blogadmin:<password>@<cluster>.mongocluster.cosmos.azure.com/?tls=true&authMechanism=SCRAM-SHA-256&retrywrites=false

# =============================================================================
# Microsoft Entra ID - REQUIRED
# =============================================================================
# This workshop uses REAL Microsoft Entra ID authentication for both
# local development and production. You must configure these values.
#
# Get these values from Azure Portal:
# - Tenant ID: Azure Portal > Microsoft Entra ID > Overview > Tenant ID
# - Client ID: Azure Portal > App registrations > Backend API > Application (client) ID
#
# See /docs/entra-id-setup.md for detailed setup instructions.
# =============================================================================
ENTRA_TENANT_ID=your-tenant-id-here
ENTRA_CLIENT_ID=your-backend-api-client-id-here

# =============================================================================
# Logging
# =============================================================================
LOG_LEVEL=debug

# =============================================================================
# CORS - LOCAL DEVELOPMENT
# =============================================================================
# Allow frontend dev server
# PaaS: In production, this is set to the Static Web Apps URL
CORS_ORIGINS=http://localhost:5173,http://localhost:8080

# =============================================================================
# Rate Limiting
# =============================================================================
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# =============================================================================
# Local Development Tools Summary
# =============================================================================
# | Tool                  | Port   | Purpose                                  |
# |-----------------------|--------|------------------------------------------|
# | Vite (Frontend)       | 5173   | Main entry point + Hot-reload dev server |
# | Express (Backend)     | 8080   | REST API server                          |
# | MongoDB               | 27017  | Database (Docker)                        |
# | Mongo Express         | 8081   | Database Web UI                          |
# =============================================================================
#
# Authentication Flow:
# 1. User clicks login in frontend (localhost:5173)
# 2. MSAL redirects to Microsoft login page
# 3. User authenticates with Microsoft account
# 4. Microsoft redirects back to localhost:5173 with auth code
# 5. MSAL exchanges code for tokens
# 6. Frontend includes access token in API requests
# 7. Backend validates JWT token against Entra ID
# =============================================================================
